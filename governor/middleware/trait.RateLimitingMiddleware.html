<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Defines the behavior and return values of rate limiting decisions."><title>RateLimitingMiddleware in governor::middleware - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="governor" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.0-nightly (b01cc1cf0 2025-11-05)" data-channel="nightly" data-search-js="search-5c29b3b5.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-ce535bd0.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">RateLimitingMiddleware</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../governor/index.html">governor</a><span class="version">0.10.1</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Rate<wbr>Limiting<wbr>Middleware</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#defining-your-own-middleware" title="Defining your own middleware">Defining your own middleware</a></li></ul><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.NegativeOutcome" title="NegativeOutcome">NegativeOutcome</a></li><li><a href="#associatedtype.PositiveOutcome" title="PositiveOutcome">PositiveOutcome</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.allow" title="allow">allow</a></li><li><a href="#tymethod.disallow" title="disallow">disallow</a></li></ul><h3><a href="#dyn-compatibility">Dyn Compatibility</a></h3><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2><a href="index.html">In governor::<wbr>middleware</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">governor</a>::<wbr><a href="index.html">middleware</a></div><h1>Trait <span class="trait">Rate<wbr>Limiting<wbr>Middleware</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/governor/middleware.rs.html#172-215">Source</a> </span></div><pre class="rust item-decl"><code>pub trait RateLimitingMiddleware&lt;P: <a class="trait" href="../clock/trait.Reference.html" title="trait governor::clock::Reference">Reference</a>&gt;: <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> {
    type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>;
    type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>;

    // Required methods
    fn <a href="#tymethod.allow" class="fn">allow</a>&lt;K&gt;(
        key: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;K</a>,
        state: impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;,
    ) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.PositiveOutcome" title="type governor::middleware::RateLimitingMiddleware::PositiveOutcome">PositiveOutcome</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.disallow" class="fn">disallow</a>&lt;K&gt;(
        key: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;K</a>,
        limiter: impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;,
        start_time: P,
    ) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.NegativeOutcome" title="type governor::middleware::RateLimitingMiddleware::NegativeOutcome">NegativeOutcome</a>;
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Defines the behavior and return values of rate limiting decisions.</p>
<p>While the rate limiter defines whether a decision is positive, the
middleware defines what additional values (other than <code>Ok</code> or <code>Err</code>)
are returned from the <a href="../struct.RateLimiter.html" title="struct governor::RateLimiter"><code>RateLimiter</code></a>’s check methods.</p>
<p>The default middleware in this crate is <a href="struct.NoOpMiddleware.html" title="struct governor::middleware::NoOpMiddleware"><code>NoOpMiddleware</code></a> (which does
nothing in the positive case and returns <a href="../struct.NotUntil.html" title="struct governor::NotUntil"><code>NotUntil</code></a> in the
negative) - so it does only the smallest amount of work it needs to do
in order to be useful to users.</p>
<p>Other middleware gets to adjust these trade-offs: The pre-made
<a href="struct.StateInformationMiddleware.html" title="struct governor::middleware::StateInformationMiddleware"><code>StateInformationMiddleware</code></a> returns quota and burst capacity
information, while custom middleware could return a set of HTTP
headers or increment counters per each rate limiter key’s decision.</p>
<h2 id="defining-your-own-middleware"><a class="doc-anchor" href="#defining-your-own-middleware">§</a>Defining your own middleware</h2>
<p>Here’s an example of a rate limiting middleware that does no
computations at all on positive and negative outcomes: All the
information that a caller will receive is that a request should be
allowed or disallowed. This can allow for faster negative outcome
handling, and is useful if you don’t need to tell users when they
can try again (or anything at all about their rate limiting
status).</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>governor::{middleware::{RateLimitingMiddleware, StateSnapshot},
               Quota, RateLimiter, clock::Reference};
<span class="attr">#[derive(Debug)]
</span><span class="kw">struct </span>NullMiddleware;

<span class="kw">impl</span>&lt;P: Reference&gt; RateLimitingMiddleware&lt;P&gt; <span class="kw">for </span>NullMiddleware {
    <span class="kw">type </span>PositiveOutcome = ();
    <span class="kw">type </span>NegativeOutcome = ();

    <span class="kw">fn </span>allow&lt;K&gt;(_key: <span class="kw-2">&amp;</span>K, _state: <span class="kw">impl </span>Into&lt;StateSnapshot&gt;) -&gt; <span class="self">Self</span>::PositiveOutcome {}
    <span class="kw">fn </span>disallow&lt;K&gt;(<span class="kw">_</span>: <span class="kw-2">&amp;</span>K, <span class="kw">_</span>: <span class="kw">impl </span>Into&lt;StateSnapshot&gt;, <span class="kw">_</span>: P) -&gt; <span class="self">Self</span>::NegativeOutcome {}
}

<span class="kw">let </span>lim = RateLimiter::direct(Quota::per_hour(<span class="macro">nonzero!</span>(<span class="number">1_u32</span>)))
    .with_middleware::&lt;NullMiddleware&gt;();

<span class="macro">assert_eq!</span>(lim.check(), <span class="prelude-val">Ok</span>(()));
<span class="macro">assert_eq!</span>(lim.check(), <span class="prelude-val">Err</span>(()));</code></pre></div></div></details><h2 id="required-associated-types" class="section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><details class="toggle" open><summary><section id="associatedtype.PositiveOutcome" class="method"><a class="src rightside" href="../../src/governor/middleware.rs.html#181">Source</a><h4 class="code-header">type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></h4></section></summary><div class="docblock"><p>The type that’s returned by the rate limiter when a cell is allowed.</p>
<p>By default, rate limiters return <code>Ok(())</code>, which does not give
much information. By using custom middleware, users can obtain
more information about the rate limiter state that was used to
come to a decision. That state can then be used to pass
information downstream about, e.g. how much burst capacity is
remaining.</p>
</div></details><details class="toggle" open><summary><section id="associatedtype.NegativeOutcome" class="method"><a class="src rightside" href="../../src/governor/middleware.rs.html#188">Source</a><h4 class="code-header">type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a>: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></h4></section></summary><div class="docblock"><p>The type that’s returned by the rate limiter when a cell is <em>not</em> allowed.</p>
<p>By default, rate limiters return <code>Err(NotUntil)</code>, which
allows interrogating the minimum amount of time to wait until
a client can expect to have a cell allowed again.</p>
</div></details></div><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.allow" class="method"><a class="src rightside" href="../../src/governor/middleware.rs.html#202">Source</a><h4 class="code-header">fn <a href="#tymethod.allow" class="fn">allow</a>&lt;K&gt;(key: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;K</a>, state: impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.PositiveOutcome" title="type governor::middleware::RateLimitingMiddleware::PositiveOutcome">PositiveOutcome</a></h4></section></summary><div class="docblock"><p>Called when a positive rate-limiting decision is made.</p>
<p>This function is able to affect the return type of
<a href="../struct.RateLimiter.html#method.check">RateLimiter.check</a>
(and others) in the Ok case: Whatever is returned here is the
value of the Ok result returned from the check functions.</p>
<p>The function is passed a snapshot of the rate-limiting state
updated to <em>after</em> the decision was reached: E.g., if there
was one cell left in the burst capacity before the decision
was reached, the <a href="struct.StateSnapshot.html#method.remaining_burst_capacity" title="method governor::middleware::StateSnapshot::remaining_burst_capacity"><code>StateSnapshot::remaining_burst_capacity</code></a>
method will return 0.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.disallow" class="method"><a class="src rightside" href="../../src/governor/middleware.rs.html#210-214">Source</a><h4 class="code-header">fn <a href="#tymethod.disallow" class="fn">disallow</a>&lt;K&gt;(
    key: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;K</a>,
    limiter: impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a>&gt;,
    start_time: P,
) -&gt; Self::<a class="associatedtype" href="trait.RateLimitingMiddleware.html#associatedtype.NegativeOutcome" title="type governor::middleware::RateLimitingMiddleware::NegativeOutcome">NegativeOutcome</a></h4></section></summary><div class="docblock"><p>Called when a negative rate-limiting decision is made (the
“not allowed but OK” case).</p>
<p>This method returns whatever value is returned inside the
<code>Err</code> variant a <a href="../struct.RateLimiter.html" title="struct governor::RateLimiter"><code>RateLimiter</code></a>’s check
method returns.</p>
</div></details></div><h2 id="dyn-compatibility" class="section-header">Dyn Compatibility<a href="#dyn-compatibility" class="anchor">§</a></h2><div class="dyn-compatibility-info"><p>This trait is <b>not</b> <a href="https://doc.rust-lang.org/nightly/reference/items/traits.html#dyn-compatibility">dyn compatible</a>.</p><p><i>In older versions of Rust, dyn compatibility was called "object safety", so this trait is not object safe.</i></p></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><details class="toggle implementors-toggle"><summary><section id="impl-RateLimitingMiddleware%3CP%3E-for-NoOpMiddleware%3CP%3E" class="impl"><a class="src rightside" href="../../src/governor/middleware.rs.html#228-248">Source</a><a href="#impl-RateLimitingMiddleware%3CP%3E-for-NoOpMiddleware%3CP%3E" class="anchor">§</a><h3 class="code-header">impl&lt;P: <a class="trait" href="../clock/trait.Reference.html" title="trait governor::clock::Reference">Reference</a>&gt; <a class="trait" href="trait.RateLimitingMiddleware.html" title="trait governor::middleware::RateLimitingMiddleware">RateLimitingMiddleware</a>&lt;P&gt; for <a class="struct" href="struct.NoOpMiddleware.html" title="struct governor::middleware::NoOpMiddleware">NoOpMiddleware</a>&lt;P&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.PositiveOutcome-1" class="associatedtype trait-impl"><a class="src rightside" href="../../src/governor/middleware.rs.html#231">Source</a><a href="#associatedtype.PositiveOutcome-1" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h4></section><section id="associatedtype.NegativeOutcome-1" class="associatedtype trait-impl"><a class="src rightside" href="../../src/governor/middleware.rs.html#233">Source</a><a href="#associatedtype.NegativeOutcome-1" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a> = <a class="struct" href="../struct.NotUntil.html" title="struct governor::NotUntil">NotUntil</a>&lt;P&gt;</h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-RateLimitingMiddleware%3CP%3E-for-StateInformationMiddleware" class="impl"><a class="src rightside" href="../../src/governor/middleware.rs.html#255-272">Source</a><a href="#impl-RateLimitingMiddleware%3CP%3E-for-StateInformationMiddleware" class="anchor">§</a><h3 class="code-header">impl&lt;P: <a class="trait" href="../clock/trait.Reference.html" title="trait governor::clock::Reference">Reference</a>&gt; <a class="trait" href="trait.RateLimitingMiddleware.html" title="trait governor::middleware::RateLimitingMiddleware">RateLimitingMiddleware</a>&lt;P&gt; for <a class="struct" href="struct.StateInformationMiddleware.html" title="struct governor::middleware::StateInformationMiddleware">StateInformationMiddleware</a></h3></section></summary><div class="impl-items"><section id="associatedtype.PositiveOutcome-2" class="associatedtype trait-impl"><a class="src rightside" href="../../src/governor/middleware.rs.html#257">Source</a><a href="#associatedtype.PositiveOutcome-2" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.PositiveOutcome" class="associatedtype">PositiveOutcome</a> = <a class="struct" href="struct.StateSnapshot.html" title="struct governor::middleware::StateSnapshot">StateSnapshot</a></h4></section><section id="associatedtype.NegativeOutcome-2" class="associatedtype trait-impl"><a class="src rightside" href="../../src/governor/middleware.rs.html#259">Source</a><a href="#associatedtype.NegativeOutcome-2" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.NegativeOutcome" class="associatedtype">NegativeOutcome</a> = <a class="struct" href="../struct.NotUntil.html" title="struct governor::NotUntil">NotUntil</a>&lt;P&gt;</h4></section></div></details></div><script src="../../trait.impl/governor/middleware/trait.RateLimitingMiddleware.js" async></script></section></div></main></body></html>